<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë©”ì´í”Œëœë“œ íŒŒí‹° ë°°ì •ê¸° (ë©”ìš©20/ìƒ¤í”„30 ì ìš©)</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background-color: #f4f7f6; display: flex; justify-content: center; padding: 20px; }
        .container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 850px; }
        h2 { text-align: center; color: #333; border-bottom: 2px solid #ff9100; padding-bottom: 10px; }
        .player-row { border: 1px solid #eee; padding: 15px; border-radius: 8px; margin-bottom: 10px; background: #fafafa; }
        .input-grid { display: flex; gap: 8px; align-items: center; }
        input, select { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        button { width: 100%; padding: 15px; background-color: #ff9100; border: none; border-radius: 6px; color: white; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        #result { margin-top: 25px; padding: 20px; background-color: #fff9e6; border-radius: 8px; display: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: center; }
        th { background-color: #ff9100; color: white; }
        .highlight { color: #d32f2f; font-weight: bold; font-size: 1.1em; }
        #resultMemo { display: block;margin-top: 15px;font-family: Arial, Helvetica, sans-serif;background: white;font-size: 13px;}
    </style>
</head>
<body>

<div class="container">
    <h2>ì˜¤ì§•ì–´ íŒŒí‹° ì¸µìˆ˜ ë°°ì •ê¸° <span style="font-size: 0.5em;">(ë©”ìš©20 / ìƒ¤í”„30 ì ìš©)</span></h2>
    
    <div id="playerInputs">
        <script>
            for(let i=1; i<=4; i++) {
                document.write(`
                    <div class="player-row">
                        <div class="input-grid">
                            <strong>ìœ ì € ${i}</strong>
                            <input type="text" id="name${i}" placeholder="ì´ë¦„" value="ìœ ì €${i}">
                            <input type="number" id="lv${i}" placeholder="ë ˆë²¨" value="${i == 2 ? 96 : (i == 3 ? 119 : 92)}">
                            <input type="number" id="atk${i}" placeholder="ë…¸ë²„í”„ ìŠ¤ê³µ" value="${i == 1 ? 1970 : (i == 2 ? 2051 : (i == 3 ? 2941 : 0))}">
                            <select id="job${i}">
                                <option value="hermit">í—ˆë°‹</option>
                                <option value="ranger">ë ˆì¸ì €</option>
                                <option value="sniper">ì €ê²©ìˆ˜</option>
                            </select>
                        </div>
                    </div>
                `);
            }
        </script>
    </div>

    <button onclick="calculateParty()">íŒŒí‹° ì¸µìˆ˜ ìë™ ë°°ì •</button>

    <div id="result">
        <h3>ğŸ“Š ë°°ì • ê²°ê³¼ (ë¦¬ì…€ìŠ¤í€´ë“œ HP 49,000 / ë°©ì–´ 830)</h3>
        <table>
            <thead>
                <tr>
                    <th>ë°°ì • ì¸µìˆ˜</th>
                    <th>ì´ë¦„</th>
                    <th>ìƒì„¸ (ì¶”ì •WA/LUK)</th>
                    <th>í‰ê·  ë°©ì»·</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
        <div id="resultText"></div>
        <span id="resultMemo"></span>
    </div>
</div>

<script>
    function calculateStats(baseMaxAtk, job, userLevel) {
        const mobHp = 49000;
        const mobDef = 830; // ëª¬ìŠ¤í„° ë°©ì–´ë ¥
        
        // ë ˆë²¨ ì°¨ ë³´ì • (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
        const levelDiffValue = Math.max(0, 97 - userLevel); // 97ë ˆë²¨ ëª¬ìŠ¤í„° ê¸°ì¤€

        let totalAvgDmg = 0;
        let infoText = "";

        if (job === "hermit") {
            let targetDex = userLevel >= 100 ? 140 : 130;
            let pureLuk = (userLevel * 5) + 97 - targetDex;
            let wa = (baseMaxAtk * 100) / (pureLuk * 3.6 + targetDex + 19); 
            const lukWithMW = pureLuk * 1.10;

            const baseLine = (lukWithMW * 7.71) * wa * 0.01; 
            const levelDiffValue = Math.max(0, 97 - userLevel);
            const lvPenalty = (1 - 0.023 * levelDiffValue);
            const defReductionBase = (mobDef * 0.01) / 0.8;

            const mainLineDmg = Math.max(0, (baseLine * lvPenalty) - defReductionBase);
            const shadowLineDmg = Math.max(0, (baseLine * 0.5 * lvPenalty) - defReductionBase);

            totalAvgDmg = (mainLineDmg * 2) + (shadowLineDmg * 2) * 1.10;

            infoText = `WA:${Math.round(wa)} / L:${Math.round(pureLuk)}`;
        }else {
            const maxAtk = baseMaxAtk * 1.055;
            const avgSkillMult = 1.788; 
            const mastery = 60;

            let lineDmg = (maxAtk * avgSkillMult) * (1 + (mastery / 100) * 0.9) / 2;

            const defReductionBase = (mobDef * 0.6) / (0.8 + 0.01 * mastery);
            const lvPenalty = (1 - 0.0102 * levelDiffValue);

            const mainLineDmg = Math.max(0, (lineDmg * lvPenalty) - defReductionBase);

            totalAvgDmg = mainLineDmg * 4;
            infoText = `ê¶ìˆ˜ ë¡œì§ ìœ ì§€`;
        }

        return { 
            nShot: Math.max(1, parseFloat((mobHp / totalAvgDmg).toFixed(2))),
            info: infoText
        };
    }

    function calculateParty() {
        let players = [];
        for(let i=1; i<=4; i++) {
            const name = document.getElementById(`name${i}`).value || `ìœ ì €${i}`;
            const lv = parseInt(document.getElementById(`lv${i}`).value);
            const atk = parseFloat(document.getElementById(`atk${i}`).value);
            const job = document.getElementById(`job${i}`).value;
            const calcJob = (job === "hermit") ? "hermit" : "archer";
            if(!isNaN(atk)) {
                const res = calculateStats(atk, calcJob, lv);
                let jobTxt = "";
                if(job === "hermit") jobTxt = "í—ˆë°‹";
                else if(job === "ranger") jobTxt = "ë Œì ¸";
                else if(job === "sniper") jobTxt = "ì €ê²©ìˆ˜";
                players.push({ name,lv,atk,jobTxt, ...res });
            }
        }
        players.sort((a, b) => a.nShot - b.nShot);
        const floorOrder = ["3ì¸µ", "1ì¸µ", "2ì¸µ", "4ì¸µ"];
        const resultBody = document.getElementById('resultBody');
        const resultText = document.getElementById('resultText');
        const resultMemo = document.getElementById('resultMemo');
        resultBody.innerHTML = '';
        resultText.innerHTML = '';
        resultMemo.innerHTML = '';
        players.forEach((p, idx) => {
            resultBody.innerHTML += `
                <tr>
                    <td style="font-weight:bold; color:#ff9100;">${floorOrder[idx] || 'ëŒ€ê¸°'}</td>
                    <td>${p.name}</td>
                    <td style="font-size:0.8em; color:#666;">${p.info}</td>
                    <td class="highlight">${p.nShot}ë°©</td>
                </tr>`;
            resultText.innerHTML += `${floorOrder[idx]}: ${p.name}\/ `;
            resultMemo.innerHTML += `${p.lv}${p.jobTxt}\/${p.nShot}ë°©<br>`;
        });
        document.getElementById('result').style.display = 'block';
    }
</script>

</body>
</html>